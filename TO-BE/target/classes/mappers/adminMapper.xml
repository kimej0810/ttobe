<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tobe.project.mapper.adminMapper">
	
	<select id="selectAllMember" resultType="memberVO">
 		select * from TOBE_MEMBER WHERE DELYN = 'N' order by tidx desc
 	</select>
 	<select id="selectOneId" resultType="string">
 		SELECT T_ID FROM TOBE_MEMBER WHERE TIDX = (SELECT MAX(TIDX) FROM TOBE_MEMBER)
 	</select>
	<insert id="addMember" parameterType="tobe.project.dto.MemberVO" useGeneratedKeys="true" keyProperty="tidx">
		<selectKey keyProperty="tidx" resultType="int" order="BEFORE">
			SELECT TIDX_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		insert into TOBE_MEMBER
		(tidx,t_id,t_pwd,t_email,t_addr_zipcode,t_addr_general,t_addr_detail,t_phone,t_name,t_birth,t_position,t_department,t_join_date)
		values(tidx_seq.nextval,#{t_id},#{t_pwd},#{t_email},#{t_addr_zipcode},#{t_addr_general},#{t_addr_detail},#{t_phone},
			#{t_name},#{t_birth},#{t_position},#{t_department},sysdate)
	</insert>
	<select id="selectOneMember" resultType="memberVO">
    	select * from TOBE_MEMBER where tidx = #{tidx}
    </select>
    <update id="modifyMember" parameterType="memberVO">
    	update TOBE_MEMBER set t_position = #{t_position} where tidx = #{tidx}
    </update>
    <select id="totalCountMember" parameterType="hashmap" resultType="int">
    	SELECT COUNT(*) AS CNT
    	FROM TOBE_MEMBER 
    	WHERE DELYN = 'N' AND TIDX > 0
    	AND T_NAME LIKE '%'||#{keyword}||'%'
    </select>
    <!-- fild start -->
    <insert id="addFile" parameterType="hashMap">
    	INSERT INTO FILE_INFOTEST(
    		FIDX,
    		TIDX,
    		F_TYPE,
    		F_ORG_FILE_NAME,
    		F_STORED_FILE_NAME,
    		F_FILE_SIZE
    	) values(
			F_FILE_SEQ.NEXTVAL,
			#{tidx}+1,
			#{F_TYPE},
			#{F_ORG_FILE_NAME},
			#{F_STORED_FILE_NAME},
			#{F_FILE_SIZE}
    	)
    </insert>
    <!-- 첨부파일 조회 -->
    <select id="selectOneFile" resultType="fileVO">
    	SELECT * FROM FILE_INFOTEST
    	WHERE TIDX = #{tidx}
    	AND DELYN = 'N'
    </select>
    <!-- file end -->
    <select id="searchMemberList" resultType="memberVO">
    		select * from (select row_number() over (order by tidx desc)num,
    		A.* from TOBE_MEMBER A  where 1=1
    		<include refid="search"/>
    		order by tidx desc)
    		where delyn = 'N' and num between #{rowStart} and #{rowEnd}
    </select>
    <select id="totalCountsearchMember" resultType="int">
    	<![CDATA[
    		SELECT COUNT(TIDX)
    		FROM TOBE_MEMBER
    		WHERE TIDX > 0
    	]]>
    	<include refid="search"/>
    </select>
    <sql id="search">
    	<if test="searchType != null">
 	    	<if test="searchType == 'a'.toString()">
    			AND T_ADDR_GENERAL LIKE '%'||#{keyword}||'%'
    		</if>
    		<if test="searchType == 'b'.toString()">
    			AND T_ADDR_DETAIL LIKE '%'||#{keyword}||'%'
    		</if>
    		<if test="searchType == 'u'.toString()">
    			AND T_NAME LIKE '%'||#{keyword}||'%'
    		</if>
    	</if>
    </sql>
</mapper>