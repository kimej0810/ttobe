<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="tobe.project.mappers.approvalMapper">
 
 	<insert id="writeApprovalDocument" parameterType="ApprovalVO">
 		INSERT INTO 
 			electronic_approval(EIDX, E_DOCUMENTNUM, E_RULE, E_DRAFTDATE, E_STARTDAY, E_CON, E_MEMBER, E_SEND, E_BUSEO, E_TEXTTITLE, E_TEXTCONTENT)
 		VALUES
 			(eidx_seq.nextval,e_documentnum_seq.nextval, #{e_rule}, #{e_draftDate}, #{e_startDay}, #{e_con}, #{e_member}, #{e_send}, #{e_buseo}, #{e_textTitle}, #{e_textContent})
 	</insert>
 	
 	<select id="selectOneApprovalDocumentContents" resultType="ApprovalVO" parameterType="ApprovalVO">
 		SELECT
 			*
 		FROM
 			ELECTRONIC_APPROVAL
 		WHERE
 			e_documentNum = #{e_documentNum}
 	</select>
 	
 	<update id="deleteApprovalDocument" parameterType="ApprovalVO">
 		update 
 			ELECTRONIC_APPROVAL
 		set
 			DELYN = 'Y'
 		where
 			eidx = #{eidx}
 	</update>	
 	
 	<update id="modifyApprovalDocument" parameterType="ApprovalVO">
 		update 
 			ELECTRONIC_APPROVAL
 		set
 			E_RULE = #{e_rule}, E_DRAFTDATE = #{e_draftDate}, E_STARTDAY = #{e_startDay}, E_CON = #{e_con}, E_MEMBER =  #{e_member},
 			E_SEND =  #{e_send}, E_BUSEO =  #{e_buseo}, E_TEXTTITLE =  #{e_textTitle}, E_TEXTCONTENT = #{e_textContent}
 		where
 			eidx = #{eidx} 			     
 	</update>
 	<!-- 총 게시글 개수 -->
 	<select id="totalCountApprovalWaitingDocument" parameterType="tobe.project.domain.SearchCriteria" resultType="int">
 		select count(eidx) from ELECTRONIC_APPROVAL
 			where 1=1 <include refid="search"/>
 				and eidx > 0 and delyn = 'N' and e_status = '0'
 	</select>
 	
 	<select id="totalCountApprovalProgressDocument" parameterType="tobe.project.domain.SearchCriteria" resultType="int">
 		select count(eidx) from ELECTRONIC_APPROVAL
 			where 1=1 <include refid="search"/>
 				and eidx > 0 and delyn = 'N' and e_status = '1'
 	</select>
 	
 	<select id="totalCountApprovalPaymentCompletedDocument" parameterType="tobe.project.domain.SearchCriteria" resultType="int">
 		select count(eidx) from ELECTRONIC_APPROVAL
 			where 1=1 <include refid="search"/>
 				and eidx > 0 and delyn = 'N' and e_status = '2'
 	</select>
 	<!-- 종 개수 end -->
 	
 	<!-- 페이징 -->
 	<select id="selectAllApprovalWaitingDocumentList" resultType="ApprovalVO" parameterType="tobe.project.domain.SearchCriteria">
 		select EIDX, E_DOCUMENTNUM, E_RULE, E_DRAFTDATE, E_STARTDAY, E_CON, E_MEMBER, E_SEND, E_BUSEO, E_TEXTTITLE, E_TEXTCONTENT, DELYN, E_STATUS, TIDX
 			from (
 				select EIDX, E_DOCUMENTNUM, E_RULE, E_DRAFTDATE, E_STARTDAY, E_CON, E_MEMBER, E_SEND, E_BUSEO, E_TEXTTITLE, E_TEXTCONTENT, DELYN, E_STATUS, TIDX, ROW_NUMBER() OVER(ORDER BY eidx DESC) AS RNUM
 				FROM ELECTRONIC_APPROVAL WHERE 1=1 <include refid="search"/>  and e_status= '0'
 				) WHERE delyn ='N' and RNUM BETWEEN #{rowStart} and #{rowEnd}
 	</select>
 	
 	<select id="selectAllApprovalProgressDocumentList" resultType="ApprovalVO" parameterType="tobe.project.domain.SearchCriteria">
 		select EIDX, E_DOCUMENTNUM, E_RULE, E_DRAFTDATE, E_STARTDAY, E_CON, E_MEMBER, E_SEND, E_BUSEO, E_TEXTTITLE, E_TEXTCONTENT, DELYN, E_STATUS, TIDX
 			from (
 				select EIDX, E_DOCUMENTNUM, E_RULE, E_DRAFTDATE, E_STARTDAY, E_CON, E_MEMBER, E_SEND, E_BUSEO, E_TEXTTITLE, E_TEXTCONTENT, DELYN, E_STATUS, TIDX, ROW_NUMBER() OVER(ORDER BY eidx DESC) AS RNUM
 				FROM ELECTRONIC_APPROVAL WHERE 1=1 <include refid="search"/>  and e_status= '1'
 					) WHERE delyn ='N' and RNUM BETWEEN #{rowStart} and #{rowEnd}
 	</select>
 	
 	<select id="selectAllApprovalPaymentCompletedDocumentList" resultType="ApprovalVO" parameterType="tobe.project.domain.SearchCriteria">
 		select EIDX, E_DOCUMENTNUM, E_RULE, E_DRAFTDATE, E_STARTDAY, E_CON, E_MEMBER, E_SEND, E_BUSEO, E_TEXTTITLE, E_TEXTCONTENT, DELYN, E_STATUS, TIDX
 			from (
 				select EIDX, E_DOCUMENTNUM, E_RULE, E_DRAFTDATE, E_STARTDAY, E_CON, E_MEMBER, E_SEND, E_BUSEO, E_TEXTTITLE, E_TEXTCONTENT, DELYN, E_STATUS, TIDX, ROW_NUMBER() OVER(ORDER BY eidx DESC) AS RNUM
 				FROM ELECTRONIC_APPROVAL WHERE 1=1 <include refid="search"/> and e_status= '2'
 					) WHERE delyn ='N' and RNUM BETWEEN #{rowStart} and #{rowEnd}
 	</select>
 	<!-- 페이징 end -->
 	
 	<!-- sql code 조각 -->
 	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == '문서번호'.toString()">AND E_DOCUMENTNUM LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == '기안부서'.toString()">AND E_BUSEO LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == '기안자'.toString()">AND E_MEMBER	 LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == '기안제목'.toString()">AND E_TEXTTITLE LIKE '%' || #{keyword} || '%'</if>
		</if>
	</sql>
 </mapper>