<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis/org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="tobe.project.mapper.commuteMapper">
	
	<!-- 출근시간 등록 -->
	<insert id="addStartWork">
		insert into commute_management (
			cidx,
			c_type,
			c_date,
			c_starttime,
			tidx
		)values(
			cidx_seq.nextval,
			#{c_type},
			#{c_date},
			#{c_starttime},
			#{tidx}
		)
	</insert>
	
	<!-- 퇴근시간 등록 -->
	<update id="addEndWork">
		<!-- UPDATE COMMUTE_MANAGEMENT SET C_ENDTIME = #{C_ENDTIME}, C_WORKTIME = #{C_WORKTIME}, C_TOTLALWORKTIME = #{C_TOTLALWORKTIME}
		WHERE CIDX = #{CIDX} -->
		update commute_management set c_endtime = #{c_endtime}, c_worktime = #{c_worktime} 
		where cidx = #{cidx}
	</update>
	
	<!-- 근태목록 조회 -->
	<select id="selectAllCommute" resultType="commuteVO">
		select * from commute_management where tidx = #{tidx} order by cidx desc
	</select>
	
	<!-- 근태목록 조회 테스트-->
	<select id="selectAllCommute2" resultType="commuteVO" parameterType="Map">
		select * from commute_management where c_date like '%' || #{month} || '%' and tidx = #{tidx} order by cidx desc
	</select>
	
	<!-- 연차 목록 -->
	<resultMap type="leaveVO" id="selectAllLeaveVO">
		<id column="AIDX" property="aidx"/>
		<result column="A_TYPE" property="a_type"/>
		<result column="A_STARTDATE" property="a_startdate"/>
		<result column="A_ENDDATE" property="a_enddate"/>
		<result column="A_STATUS" property="a_status"/>
		<result column="A_CONTENT" property="a_content"/>
		<result column="A_USEDDAYS" property="a_useddays"/>
		<result column="TIDX" property="tidx"/>
		<association property="memberVO" resultMap="memberResultMap"/>
	</resultMap>
	<resultMap type="memberVO" id="memberResultMap">
		<id column="TIDX" property="tidx"/>
		<result column="T_LEAVE_GET" property="t_leave_get"/>
		<result column="T_DEPARTMENT" property="t_department"/>
		<result column="T_ID" property="t_id"/>
		<result column="T_NAME" property="t_name"/>
	</resultMap>
	<!-- 
	<select id="selectAllLeave" resultMap="selectAllLeaveVO">
	SELECT * FROM (
		SELECT ANNUAL_LEAVE.AIDX,
		ANNUAL_LEAVE.A_TYPE,
		ANNUAL_LEAVE.A_STARTDATE,
		ANNUAL_LEAVE.A_ENDDATE,
		ANNUAL_LEAVE.A_USEDDAYS,
		ANNUAL_LEAVE.TIDX,
		TOBE_MEMBER.T_LEAVE_GET,
		TOBE_MEMBER.T_DEPARTMENT,
		TOBE_MEMBER.T_ID,
		TOBE_MEMBER.T_NAME
		FROM ANNUAL_LEAVE, TOBE_MEMBER WHERE TOBE_MEMBER.TIDX = #{tidx}) ORDER BY AIDX DESC
	</select> 
	 -->
	 
	<!-- 연차 등록 -->
	<insert id="addLeave" parameterType="LeaveVO"
		useGeneratedKeys="true" keyProperty="aidx">
		<selectKey keyProperty="aidx" resultType="int"
			order="BEFORE">
			SELECT AIDX_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO ANNUAL_LEAVE(
			AIDX,
			A_TYPE,
			A_STARTDATE,
			A_ENDDATE,
			A_USEDDAYS,
			TIDX
			) VALUES(
			AIDX_SEQ.NEXTVAL,
			#{A_TYPE},
			#{A_STARTDATE},
			#{A_ENDDATE},
			#{A_USEDDAYS},
			#{TIDX}
			)
	</insert>
	<insert id="writeApprovalDocument" parameterType="ApprovalDTO" keyProperty="eidx">
 		<selectKey keyProperty="eidx" resultType="int" order="BEFORE">
			SELECT eidx_SEQ.NEXTVAL FROM DUAL
		</selectKey>
 		INSERT INTO ELECTRONIC_APPROVAL(
 			EIDX, 
 			E_DOCUMENTNUM, 
 			E_RULE, 
 			E_DRAFTDATE, 
 			E_STARTDAY, 
 			E_CON, 
 			E_SEND, 
 			E_TEXTTITLE, 
 			E_TEXTCONTENT, 
 			TIDX
 			) VALUES(
 			EIDX_SEQ.NEXTVAL,
 			EIDX_DOCUMENT_SEQ.NEXTVAL,
 			#{E_RULE}, #{E_DRAFTDATE},
 			#{E_STARTDAY}, 
 			#{E_CON}, 
 			#{E_SEND}, 
 			#{E_TEXTTITLE}, 
 			#{E_TEXTCONTENT}, 
 			#{TIDX}
 			)
 	</insert>
</mapper>	